<?php/** *****************************Gnom*************************gnom-09_@mail.ru**************6.10.2009*********************Сайт:http://vip-wap.ru*******ICQ: 99-01-07*************/**/define('_IN_JOHNCMS', 1);$headmod = 'ddvip';$textl = 'Chuyển Tiền VGold';require_once ("../incfiles/core.php");require_once ("../incfiles/head.php");switch($act){	default:	if(empty($_GET['id']))	{		echo '<b>Chuyển VGold, chúng tôi không cho phép chuyển VGold:</b><br/>';                            echo '<form method="POST" action="vgold.php?act=ok">';		echo '<div class="gmenu">';		echo 'Bạn đang có: <b>'.$datauser['vgold'].' VGold</b><br/>';		echo 'Chuyển VGold qua danh sách thành viên:<br/>';		echo ' 1: <input type="radio"  value="1" name="pos" checked="checked"/>';		echo '<div class="fmenu">Nếu bạn không nhớ, hãy chọn một nick :<br/>';		echo '<select name="users">';		echo '<option value="">Danh sách</option>';		$sql = mysql_query("select `id`,`name` from `users`");		while($res = mysql_fetch_array($sql))		{			echo '<option value="'.$res['id'].'">'.$res['name'].'</option>';		}		echo '</select></div>';		echo ' 2: <input type="radio"  value="2" name="pos" />';		echo '<div class="fmenu">Viết số ID hoặc tên Nick<br/><input name="user"/></div>';		echo 'Số VGold cần chuyển:<br/><input name="bal"/></div>';		echo '<div class="menu"><input value="Chuyển VGold" type="submit" name="submit"/></div></form>';	}else{		$sql = mysql_query("select `id`,`name` from `users` WHERE `id` = '".$id."' LIMIT 1;");		if(mysql_num_rows($sql)!=="0")		{			$user = mysql_fetch_array($sql);echo '<div class="gmenu">';		  echo 'Bạn đang có: <b>'.$datauser['vgold'].' VGold</b><br/>';			echo '<form method="POST" action="vgold.php?act=ok&amp;id='.$user['id'].'">';			echo 'Chuyển VGold cho thành viên <b>'.$user['name'].'</b><br/>';			echo 'Số VGold chuyển :<br/><input name="bal"/><br/>';			echo '<input value="Chuyển" type="submit" name="submit"/></form>';		}	}	break;	case "ok";	if(empty($_GET['id']))	{		if(!empty($_POST['submit']))		{			if($_POST['pos'] == "1")			{                $user = isset($_POST['users'])?abs(intval($_POST['users'])):false;			}elseif($_POST['pos'] == "2")			{                $user = isset($_POST['user'])?check($_POST['user']):false;			}			$ball = isset($_POST['bal'])?abs(intval($_POST['bal'])):false;			$count = mysql_result(mysql_query("select COUNT(*) from `users` WHERE `id` = '".$user."' or `name` = '".$user."'"),0);			if($count > 0 )			{				$arr = mysql_fetch_array(mysql_query("select `name`,`vgold` from `users` WHERE `id` = '".$user."'  or `name` = '".$user."' LIMIT 1"));				$q = mysql_fetch_array(mysql_query("select `name`,`vgold` from `users` WHERE `id` = '".$user_id."' LIMIT 1"));				if($q['vgold'] >= 20)				{				 if($arr['name'] !== $q['name'])				 {                  if($ball > 1 && $q['vgold'] > $ball)				  {				$min_bal = intval($q['vgold'] - $ball);				$plus_bal = intval($arr['vgold'] + $ball);				mysql_query("update `users` set `vgold` = '".$min_bal."' where `id` = '".$user_id."' LIMIT 1");				mysql_query("update `users` set `vgold` = '".$plus_bal."' where `id` = '".$user."'  or `name` = '".$user."' LIMIT 1");				echo '<p>Chuyển thành công '.$ball.' VGold cho thành viên '.$arr['name'].'<br/>';				                  }else{                    echo '<p>Không thể chuyển tiền, số VGold của bạn ít hơn số VGold muốn chuyển!</p>';                  }				}else{                    echo '<p>Có lỗi, không thể chuyển tiền!</p>';				}				}else{					echo '<p>Không thể chuyển tiền, số VGold của bạn ít hơn số VGold muốn chuyển!</p>';				}			}else{				echo '<p><b>Sai tên thành viên!</b><br/>';				echo '<a href="vgold.php?r='.mt_rand(0000,9999).'">Quay lại</a></p>';				require_once ("../incfiles/end.php");				exit;			}		}else{            echo '<p><b>Có lỗi!!!</b><br/>';		    echo '<a href="vgold.php?r='.mt_rand(0000,9999).'">Quay lại</a></p>';			require_once ("../incfiles/end.php");			exit;		}	}else{        if(!empty($_POST['submit']))		{			$ball = isset($_POST['bal'])?abs(intval($_POST['bal'])):false;			$count = mysql_result(mysql_query("select COUNT(*) from `users` WHERE `id` = '".$id."'"),0);			if($count > 0 )			{				$arr = mysql_fetch_array(mysql_query("select `name`,`vgold` from `users` WHERE `id` = '".$id."' LIMIT 1"));				$q = mysql_fetch_array(mysql_query("select `name`,`vgold` from `users` WHERE `id` = '".$user_id."' LIMIT 1"));				if($q['vgold'] >= 20)				{                 if($arr['name'] !== $q['name'])				 {				  if($ball > 1 && $q['vgold'] > $ball)				  {				$min_bal = intval($q['vgold'] - $ball);				$plus_bal = intval($arr['vgold'] + $ball);				mysql_query("update `users` set `vgold` = '".$min_bal."' where `id` = '".$user_id."' LIMIT 1");				mysql_query("update `users` set `vgold` = '".$plus_bal."' where `id` = '".$id."' LIMIT 1");				echo '<p>Chuyển thành công  '.$ball.' VGold cho thành viên '.$arr['name'].'<br/>';								  }else{                    echo '<p>Không thể chuyển tiền, số VGold của bạn ít hơn số VGold muốn chuyển!</p>';				  }				 }else{                    echo '<p>Có lỗi, không thể chuyển tiền!</p>';				}				}else{					echo '<p>Không thể chuyển tiền, số VGold của bạn ít hơn số VGold muốn chuyển!</p>';				}			}else{				echo '<p><b>Sai tên thành viên!</b><br/>';				echo '<a href="vgold.php?r='.mt_rand(0000,9999).'">Quay lại</a></p>';				require_once ("../incfiles/end.php");				exit;			}		}else{            echo '<p><b>Lỗi!!!</b><br/>';		    echo '<a href="vgold.php?r='.mt_rand(0000,9999).'">Quay lại</a></p>';			require_once ("../incfiles/end.php");			exit;		}	}	break;}require_once ("../incfiles/end.php");?>